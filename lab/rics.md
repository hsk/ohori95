## hindley milner の gen と let の合成

    Γ |- e0 : σ    Γ,x:σ |- e1 : τ
    ――――――――――――――――― Let
    Γ |- let x = e0 in e1 : τ

    Γ |- e : σ    α ∉ free(Γ)
    ――――――――――――――――― Gen
    Γ |- e : ∀α.σ
    ↓
    Γ |- e0 : τ   Γ,x:gen(τ) |- e1 τ'
    ――――――――――――――――― Let
    Γ |- let x = e0 in e1 : τ'
    gen(τ) = ∀(a*,τ)    a* = free(τ)-free(Γ)

このことをふまえて、多相レコードの推論について考えてみる。

    (K[t1::k1···tn::kn],L,T) ▷ C : τ  %ti ∉ FTV(L ∪ T) (1 ≤ i ≤ n)
    --%---------------------------------------------------------- GEN 
    (K,L,T) ▷ C : ∀([t1::kn,···,tn::kn],τ).

    (K,L,T) ▷ C1 : σ,   (K,L,[x:σ|T]) ▷ C2 : τ
    --%---------------------------------------------------------- LET
    (K,L,T) ▷ (let(x=C1);C2) : τ.

この2つの規則を合成するといかのようになる:

    (K,L,T) ▷ C1 : τ1, (K[t1::k1···tn::kn],L,[x:τ1|T]) ▷ C2 : ∀([t1::kn,···,tn::kn],τ)
    %ti ∉ FTV(L ∪ T) (1 ≤ i ≤ n)
    --%---------------------------------------------------------- LET
    (K,L,T) ▷ (let(x=C1);C2) : ∀([t1::kn,···,tn::kn],τ).

ti をどう求めるかは問題として残るけれども、とにかくこう書ける。
ti はLとTにftvに含まれないカインドであるようで、σ内にあるカインドを見つけるアルゴリズムが必要そうだ
K ⊢ t::k によってカインドは求められるけれども求められるカインドはレコードやヴァリアント型の形をしている。
σについてのカインドは、gen(τ) = ∀(a*,τ)    a* = free(τ)-free(L)-free(T)と書けるだろうけど、a*はただの型のリストである。
σについての自由型変数からLとTの自由型変数のリストを求めて差分をとったもの


    (K,L,T) ▷ C1 : τ1, as=FTV(τ1)-FTV(L ∪ T),
    maplist([a,a::k]>>(K⊢a::k),as,tks),K2 = K - tks,
    (K2,L,[x:τ1|T]) ▷ C2 : ∀(tks,τ)
    --%---------------------------------------------------------- LET
    (K,L,T) ▷ (let(x=C1);C2) : ∀(tks,τ).

とかけそうだ。

## var と inst の合成

    x : σ ∈ Γ
    ―――――――――――― Var
    Γ |- x : σ

    Γ |- e : σ'   inst(σ',σ)
    ―――――――――――― Inst
    Γ |- e : σ
    ↓
    x : σ ∈ Γ    inst(σ,τ)
    ―――――――――――― Var
    Γ |- x : τ

  と書き換えられる。なぜならば

    x : σ ∈ Γ
    ―――――――――――― Var
    Γ |- x : σ

    Γ |- e : σ    inst(σ,τ)
    ―――――――――――― Inst
    Γ |- e : τ
  であるので、
    x : σ ∈ Γ
    ―――――――――――― Var
    Γ |- x : σ
    ならば
    x : σ ∈ Γ    inst(σ,τ)
    ―――――――――――― Var
    Γ |- x : τ
  であるからだ。

同様の変形を

    VAR       K,L,T{x:σ} ▷ x : τ      if T{x:σ} and L are well formed under K and K ⊢ σ ≥ τ

でする必要がある。インスタンス化は要するにTの中からσを取り出してカインドの制約を消せばよくて
σに含まれるカインドはKとLによって制約をうけるのかな？？？うーわからん。なのだな。
τはKの制約の下でσのサブタイプであればよいのだけど、通常のインスタンス化のように型変数を割り当てればいいというわけではない。
